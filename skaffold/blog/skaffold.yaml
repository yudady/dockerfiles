apiVersion: skaffold/v3
kind: Config

build:
  local:
    push: false # don't push on Docker Hub
  # something that needs to be maintained
  artifacts:
    - image: nkolchakov/client # rebuild entire image if below sync files are not matched
      context: client # watch for changes in this dir
    - image: nkolchakov/comments
      context: comments
    - image: nkolchakov/event-bus
      context: event-bus
    - image: nkolchakov/moderation
      context: moderation
    - image: nkolchakov/posts
      context: posts
    - image: nkolchakov/query
      context: query

profiles:
  - name: blog
    activation:
      - command: dev
      - kubeContext: minikube
    build:
      artifacts:
        - image: yudady/client # rebuild entire image if below sync files are not matched
          context: client # watch for changes in this dir
          docker:
            dockerfile: Dockerfile
          sync:
            manual:
              - src: "src/**/*.js" # when js file is changed, copy it to the Pod
                dest: .
        - image: yudady/comments
          context: comments
          docker:
            dockerfile: Dockerfile
          sync:
            manual:
              - src: "*.js"
                dest: .
        - image: yudady/event-bus
          context: event-bus
          docker:
            dockerfile: Dockerfile
          sync:
            manual:
              - src: "*.js"
                dest: .
        - image: yudady/moderation
          context: moderation
          docker:
            dockerfile: Dockerfile
          sync:
            manual:
              - src: "*.js"
                dest: .
        - image: yudady/posts
          context: posts
          docker:
            dockerfile: Dockerfile
          sync:
            manual:
              - src: "*.js"
                dest: .
        - image: yudady/query
          context: query
          docker:
            dockerfile: Dockerfile
          sync:
            manual:
              - src: "*.js"
                dest: .
manifests:
  rawYaml:
    - ./infra/k8s/*